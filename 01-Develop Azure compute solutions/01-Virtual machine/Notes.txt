AZURE VIRTUAL MACHINES - NOTES
================================

DEFINITION
----------
Azure Virtual Machines (VMs) are on-demand, scalable computing resources that provide the flexibility of virtualization without having to buy and maintain physical hardware. 
A VM is a software emulation of a physical computer that runs an operating system and applications just like a physical computer.

KEY CHARACTERISTICS
-------------------
- Infrastructure as a Service (IaaS) offering
- Full control over the operating system
- Support for custom software and hosting configurations
- Available in various sizes and configurations
- Can run Windows or Linux operating systems
- Pay only for what you use (consumption-based pricing)

WHEN TO USE AZURE VMs
---------------------
- During testing and development
- When running applications in the cloud
- When extending your datacenter to the cloud
- During disaster recovery scenarios
- When you need complete control over the OS
- When migrating from physical servers (lift-and-shift)
- When running custom software or specific OS configurations

VM COMPONENTS
-------------
1. Virtual Machine itself
2. Virtual Hard Disks (VHDs) - OS and data disks
3. Virtual Network Interface Card (NIC)
4. Network Security Group (NSG)
5. Public IP address (optional)
6. Virtual Network (VNet)

VM SIZES AND SERIES
-------------------
- General Purpose (B, D series): Balanced CPU-to-memory ratio
- Compute Optimized (F series): High CPU-to-memory ratio
- Memory Optimized (E, M series): High memory-to-CPU ratio
- Storage Optimized (L series): High disk throughput and IO
- GPU (N series): Heavy graphic rendering and video editing
- High Performance Compute (H series): Scientific computations

AVAILABILITY OPTIONS
--------------------
1. Availability Sets: Protect against hardware failures within a datacenter
2. Availability Zones: Protect against entire datacenter failures
3. Virtual Machine Scale Sets: Auto-scaling group of identical VMs
4. Azure Site Recovery: Disaster recovery solution

DISK OPTIONS
------------
1. OS Disk: Contains the operating system
2. Temporary Disk: Short-term storage (data may be lost during maintenance)
3. Data Disks: Additional persistent storage
4. Managed Disks: Azure-managed storage (recommended)
5. Unmanaged Disks: Customer-managed storage accounts

DISK TYPES
----------
- Ultra Disk: Highest performance, low latency
- Premium SSD: High performance for production workloads
- Standard SSD: Consistent performance for web servers, dev/test
- Standard HDD: Cost-effective for backup and non-critical workloads

PRICING MODELS
--------------
1. Pay-as-you-go: Pay for compute capacity by the second
2. Reserved Instances: 1 or 3-year commitment for cost savings (up to 72%)
3. Spot VMs: Purchase unused capacity at discounted rates
4. Azure Hybrid Benefit: Use existing Windows Server licenses

SECURITY FEATURES
-----------------
- Network Security Groups (NSGs): Control inbound/outbound traffic
- Azure Firewall: Managed cloud-based network security
- Azure Bastion: Secure RDP/SSH connectivity
- Just-in-Time (JIT) VM Access: Reduce exposure to attacks
- Disk Encryption: Azure Disk Encryption for OS and data disks
- Microsoft Defender for Cloud: Security posture management

MANAGEMENT AND MONITORING
-------------------------
- Azure Portal: Web-based management interface
- Azure CLI: Command-line interface for automation
- Azure PowerShell: PowerShell modules for Azure management
- Azure Resource Manager (ARM) Templates: Infrastructure as Code
- Azure Monitor: Collect and analyze telemetry data
- Azure Automation: Process automation and configuration management

VM EXTENSIONS
-------------
- Small applications that provide post-deployment configuration
- Examples: Custom Script Extension, DSC Extension, Antimalware Extension
- Can be managed through ARM templates, CLI, or Portal

BACKUP AND DISASTER RECOVERY
----------------------------
- Azure Backup: Application-consistent VM backups
- Azure Site Recovery: Replicate VMs to secondary region
- Snapshots: Point-in-time copy of managed disks
- Custom Images: Create reusable VM images

BEST PRACTICES
--------------
1. Use Managed Disks for simplified disk management
2. Implement availability sets or zones for high availability
3. Enable Azure Backup for data protection
4. Apply NSG rules to restrict network access
5. Use Reserved Instances for predictable workloads
6. Enable monitoring and diagnostics
7. Apply updates and patches regularly
8. Use Azure Hybrid Benefit when applicable
9. Right-size VMs to optimize costs
10. Use tags for resource organization and cost tracking

LIMITATIONS
-----------
- Cannot change VM size if it requires different hardware
- Some VM sizes not available in all regions
- Subscription limits on number of VMs and cores
- Maintenance events may require VM restart

COMMON USE CASES
----------------
- Web servers and application hosting
- Development and testing environments
- Database servers
- Big data and analytics workloads
- Backup and disaster recovery
- High-performance computing
- Virtual desktop infrastructure (VDI)
- Legacy application hosting

IMPORTANT CONSIDERATIONS WHEN USING AZURE VMs
==============================================

PLANNING AND DESIGN
-------------------
1. **Region Selection**
   - Choose regions close to your users for better latency
   - Consider data residency and compliance requirements
   - Verify VM size availability in target region
   - Plan for disaster recovery with secondary region

2. **VM Sizing**
   - Start with the right size based on workload requirements
   - Monitor performance metrics to identify over/under-provisioning
   - Consider CPU, memory, storage, and network requirements
   - Remember that resizing may require VM restart
   - Not all sizes are available in all regions

3. **Naming Conventions**
   - Establish consistent naming standards
   - Include environment, location, application, and instance number
   - Example: prod-eastus-web-vm01
   - Use Azure naming conventions and restrictions

4. **Resource Organization**
   - Group related resources in the same resource group
   - Use tags for cost tracking, ownership, and environment
   - Plan subscription and resource group hierarchy
   - Consider management groups for multiple subscriptions

NETWORKING CONSIDERATIONS
--------------------------
1. **Virtual Network Planning**
   - Plan IP address space carefully (avoid overlapping with on-premises)
   - Use appropriate subnet segmentation
   - Consider future growth and expansion
   - Plan for hybrid connectivity (VPN/ExpressRoute)

2. **Network Security**
   - Always implement Network Security Groups (NSGs)
   - Follow principle of least privilege for network access
   - Use Application Security Groups for logical grouping
   - Avoid exposing VMs directly to the internet when possible
   - Use Azure Bastion or JIT access for management

3. **Load Balancing**
   - Use Azure Load Balancer for distributing traffic
   - Consider Application Gateway for HTTP/HTTPS workloads
   - Plan for session persistence requirements
   - Implement health probes for automatic failover

4. **Bandwidth and Throughput**
   - Different VM sizes have different network bandwidth limits
   - Monitor network performance metrics
   - Use Accelerated Networking when available
   - Consider proximity placement groups for low latency

STORAGE CONSIDERATIONS
----------------------
1. **Disk Selection**
   - Always use Managed Disks (easier management, better reliability)
   - Choose appropriate disk type based on IOPS requirements
   - OS disk: Premium SSD recommended for production
   - Temporary disk: Data is not persistent, don't store critical data
   - Size disks appropriately to meet performance needs

2. **Data Persistence**
   - Never store critical data on temporary disk
   - Implement regular backup strategy
   - Use Azure Backup or custom backup solutions
   - Consider geo-replication for critical data

3. **Disk Performance**
   - Premium SSD provides guaranteed IOPS and throughput
   - Standard SSD provides consistent performance
   - Disk size affects performance (larger = more IOPS)
   - Consider disk caching options (Read-only, Read/Write, None)
   - Monitor disk metrics to identify bottlenecks

4. **Disk Encryption**
   - Enable Azure Disk Encryption for data at rest
   - Plan key management strategy (Azure Key Vault)
   - Consider compliance requirements
   - Encryption may have minor performance impact

COST OPTIMIZATION
-----------------
1. **Right-Sizing**
   - Regularly review VM utilization metrics
   - Downsize or deallocate underutilized VMs
   - Use burstable B-series for variable workloads
   - Avoid over-provisioning resources

2. **Purchasing Options**
   - Use Reserved Instances for steady-state workloads (save up to 72%)
   - Consider Spot VMs for interruptible workloads (save up to 90%)
   - Apply Azure Hybrid Benefit for Windows Server VMs
   - Evaluate 1-year vs 3-year commitments

3. **Operational Costs**
   - Deallocate (don't just stop) VMs when not needed
   - Delete unused disks, NICs, and public IPs
   - Use auto-shutdown for dev/test environments
   - Monitor and optimize data transfer costs
   - Implement Azure Advisor recommendations

4. **Storage Costs**
   - Use appropriate disk tier for workload
   - Clean up old snapshots and images
   - Consider Standard HDD for non-critical data
   - Archive old data to cheaper storage tiers

SECURITY CONSIDERATIONS
-----------------------
1. **Identity and Access**
   - Use Azure Active Directory for authentication
   - Implement Role-Based Access Control (RBAC)
   - Enable Multi-Factor Authentication (MFA)
   - Use Managed Identities instead of credentials
   - Regular audit of access permissions

2. **Patch Management**
   - Enable automatic updates for security patches
   - Use Azure Update Management for centralized patching
   - Test patches in non-production first
   - Maintain patch compliance for audit requirements
   - Schedule maintenance windows appropriately

3. **Endpoint Protection**
   - Install and maintain antimalware solutions
   - Use Microsoft Defender for Cloud
   - Enable vulnerability scanning
   - Monitor security alerts and recommendations
   - Implement endpoint detection and response (EDR)

4. **Data Protection**
   - Encrypt data at rest and in transit
   - Use Azure Disk Encryption
   - Implement TLS/SSL for network communications
   - Regular backup and test restore procedures
   - Plan for disaster recovery scenarios

5. **Compliance**
   - Understand regulatory requirements (GDPR, HIPAA, etc.)
   - Use Azure Policy for compliance enforcement
   - Enable diagnostic logging and audit trails
   - Implement data residency requirements
   - Regular compliance assessments

AVAILABILITY AND RELIABILITY
----------------------------
1. **High Availability Design**
   - Deploy VMs across Availability Zones (99.99% SLA)
   - Use Availability Sets for fault/update domains (99.95% SLA)
   - Implement load balancing for redundancy
   - Single VM with Premium SSD (99.9% SLA)
   - Plan for maintenance events

2. **Backup Strategy**
   - Enable Azure Backup with appropriate retention
   - Test restore procedures regularly
   - Document backup and recovery procedures
   - Consider backup frequency based on RPO
   - Store backups in geo-redundant storage

3. **Disaster Recovery**
   - Implement Azure Site Recovery for critical VMs
   - Define Recovery Point Objective (RPO) and Recovery Time Objective (RTO)
   - Regular DR testing and drills
   - Document failover procedures
   - Replicate to secondary region

4. **Monitoring and Alerting**
   - Enable boot diagnostics for troubleshooting
   - Configure Azure Monitor alerts for critical metrics
   - Set up alerts for CPU, memory, disk, and network
   - Monitor VM availability and health
   - Implement log analytics for insights

PERFORMANCE CONSIDERATIONS
--------------------------
1. **VM Performance**
   - Choose VM size with appropriate CPU and memory
   - Monitor CPU, memory, disk, and network metrics
   - Use Premium SSD for performance-sensitive workloads
   - Enable Accelerated Networking for network-intensive workloads
   - Consider proximity placement groups for low latency

2. **Disk Performance**
   - Choose appropriate disk tier and size
   - Enable read caching for OS disk
   - Separate OS and data disks
   - Use disk striping for higher throughput
   - Monitor IOPS and throughput metrics

3. **Network Performance**
   - Use Accelerated Networking when available
   - Monitor network latency and bandwidth
   - Place VMs in same VNet for better performance
   - Use proximity placement groups for tightly-coupled workloads
   - Consider ExpressRoute for hybrid scenarios

4. **Application Performance**
   - Optimize application code and configuration
   - Use caching strategies appropriately
   - Implement connection pooling
   - Monitor application metrics
   - Profile and optimize database queries

OPERATIONAL CONSIDERATIONS
--------------------------
1. **Automation**
   - Use ARM templates or Bicep for infrastructure as code
   - Implement CI/CD pipelines for deployments
   - Automate common operational tasks
   - Use Azure Automation for scheduled tasks
   - Version control infrastructure code

2. **Maintenance**
   - Plan for scheduled maintenance windows
   - Communicate maintenance to stakeholders
   - Test changes in non-production first
   - Document maintenance procedures
   - Use Azure Maintenance Control when available

3. **Scaling**
   - Plan for growth and scaling requirements
   - Use VM Scale Sets for automatic scaling
   - Define scale-out and scale-in rules
   - Test scaling scenarios
   - Monitor scaling metrics and thresholds

4. **Documentation**
   - Document VM configurations and dependencies
   - Maintain runbooks for common operations
   - Document disaster recovery procedures
   - Keep network diagrams up to date
   - Track configuration changes

MIGRATION CONSIDERATIONS
------------------------
1. **Assessment**
   - Inventory on-premises infrastructure
   - Identify dependencies between systems
   - Assess workload requirements and compatibility
   - Evaluate licensing requirements
   - Estimate costs in Azure

2. **Migration Strategy**
   - Choose appropriate migration approach (rehost, refactor, rebuild)
   - Use Azure Migrate for assessment and migration
   - Plan migration phases and timeline
   - Identify pilot workloads for initial migration
   - Plan for testing and validation

3. **Post-Migration**
   - Optimize VM sizes and configurations
   - Implement cloud-native services where appropriate
   - Decommission on-premises resources
   - Monitor performance and costs
   - Gather lessons learned for future migrations

COMPLIANCE AND GOVERNANCE
--------------------------
1. **Azure Policy**
   - Implement policies for resource compliance
   - Enforce naming conventions and tagging
   - Restrict VM sizes and regions
   - Require encryption and backups
   - Audit non-compliant resources

2. **Cost Management**
   - Set up budgets and alerts
   - Use cost analysis to track spending
   - Implement showback/chargeback
   - Regular cost optimization reviews
   - Tag resources for cost allocation

3. **Resource Management**
   - Use resource locks to prevent accidental deletion
   - Implement RBAC for least privilege access
   - Regular access reviews and audits
   - Clean up unused resources
   - Monitor resource quotas and limits

LIMITATIONS OF AZURE VIRTUAL MACHINES
======================================

RESOURCE LIMITS AND QUOTAS
--------------------------
1. **Subscription Quotas**
   - Default vCPU quota per region (varies by subscription type)
   - Total Regional vCPUs limit (typically 10-20 by default)
   - Standard family-specific vCPU limits (D-series, F-series, etc.)
   - Spot VM vCPU limits (separate from standard quotas)
   - Can request quota increases through Azure Portal
   - Quota increases require approval and may take time

2. **VM Instance Limits**
   - Maximum VMs per subscription: Varies by region
   - Maximum VMs per cloud service: 50
   - Maximum VMs per availability set: 200 (fault domains Ã— update domains)
   - Maximum VMs per virtual machine scale set: 1000 (standard), 600 (with managed disks)

3. **Storage Limits**
   - Maximum data disks per VM: Depends on VM size (typically 4-64)
   - Maximum disk size: 32,767 GiB for managed disks
   - Maximum IOPS per VM: Depends on VM size
   - Maximum throughput per VM: Depends on VM size
   - Maximum storage accounts per subscription: 250 per region

4. **Network Limits**
   - Maximum NICs per VM: Depends on VM size (1-8)
   - Maximum private IP addresses per NIC: 256
   - Maximum NSG rules: 1000 per NSG
   - Maximum load-balanced endpoints: 150 per load balancer

SIZE AND SCALING LIMITATIONS
----------------------------
1. **VM Resizing Restrictions**
   - Cannot resize between different hardware generations without deallocating
   - Cannot change from premium-storage to non-premium storage capable sizes
   - Some sizes only available in specific regions
   - Resizing requires VM restart (downtime)
   - May need to move to different hardware cluster

2. **Hardware Constraints**
   - Cannot choose specific physical hardware
   - No control over CPU microarchitecture
   - Limited GPU options (specific N-series)
   - Cannot add physical hardware like USB devices
   - No direct access to physical host

3. **VM Size Availability**
   - Not all VM sizes available in all regions
   - Older generation sizes may be retired
   - New sizes may take time to become available
   - Capacity constraints during high-demand periods
   - Some specialized sizes (GPU, HPC) limited to specific regions

PERFORMANCE LIMITATIONS
-----------------------
1. **CPU Performance**
   - Shared physical hardware (except isolated sizes)
   - No CPU pinning or NUMA control
   - Noisy neighbor effect possible
   - Throttling under sustained high CPU usage (B-series)
   - Limited control over CPU features and flags

2. **Disk I/O Limitations**
   - IOPS caps based on disk size and VM size
   - Throughput limits per disk and per VM
   - Temporary disk performance varies by VM size
   - Burst credits for standard SSDs (limited duration)
   - Cannot exceed maximum IOPS regardless of configuration

3. **Network Performance**
   - Network bandwidth caps based on VM size
   - Shared network infrastructure
   - Latency varies based on region and routing
   - Cross-region traffic has higher latency
   - Limited control over packet routing

4. **Memory Limitations**
   - Fixed memory allocation per VM size
   - Cannot add memory without resizing VM
   - No memory overcommitment
   - Swap/page file uses disk (slower than RAM)

AVAILABILITY LIMITATIONS
------------------------
1. **SLA Constraints**
   - Single VM: 99.9% SLA (requires Premium SSD/Ultra Disk)
   - Availability Set: 99.95% SLA
   - Availability Zone: 99.99% SLA
   - No SLA for VMs without managed disks or with Standard HDD
   - SLA doesn't cover application-level issues

2. **Maintenance Windows**
   - Planned maintenance may require reboots
   - Memory-preserving updates (most common)
   - Redeployment to different host possible
   - Limited control over maintenance timing
   - Some maintenance cannot be postponed

3. **Regional Failures**
   - Single region deployment vulnerable to regional outages
   - Manual failover required without ASR
   - RTO depends on configuration and automation
   - DNS changes needed for failover

OPERATIONAL LIMITATIONS
-----------------------
1. **Operating System Restrictions**
   - Limited to supported OS versions
   - Custom kernels may not be supported
   - Some OS features unavailable in virtualized environment
   - Licensing constraints for certain software
   - Cannot run all hypervisors (no nested virtualization on most sizes)

2. **Backup and Recovery**
   - Azure Backup has retention limits (9999 recovery points)
   - Backup window required for consistent backups
   - Large VM backups take significant time
   - Cross-region restore has higher RTO
   - Snapshot limits per disk

3. **Security Limitations**
   - No physical access to hardware
   - Trust boundary at hypervisor level
   - Compliance depends on Azure certifications
   - Some security tools may not work properly
   - Limited control over host security

4. **Monitoring Constraints**
   - Metrics have retention limits (93 days by default)
   - Diagnostic data requires storage configuration
   - Some hardware-level metrics unavailable
   - Real-time monitoring has granularity limits
   - Historical data requires additional services

NETWORK LIMITATIONS
-------------------
1. **IP Addressing**
   - Cannot use all IPs in a subnet (Azure reserves 5)
   - Static private IPs must be within VNet range
   - Public IP addresses cost extra
   - IPv6 support limited (dual-stack available)
   - Cannot change VNet after VM creation without recreation

2. **Connectivity Restrictions**
   - Outbound SMTP (port 25) blocked by default for security
   - Some ports require special configuration
   - Cross-VNet communication requires peering or gateway
   - Site-to-site VPN has bandwidth limits
   - ExpressRoute required for higher bandwidth on-premises connectivity

3. **Load Balancing**
   - Basic Load Balancer limited to single availability set
   - Session persistence limitations
   - Health probe frequency constraints
   - Maximum number of backend pool instances
   - No cross-region load balancing without additional services

MIGRATION AND COMPATIBILITY
---------------------------
1. **Migration Challenges**
   - Not all workloads suitable for cloud migration
   - Application compatibility issues possible
   - Licensing restrictions for some software
   - Performance differences from physical hardware
   - Network topology changes required

2. **Legacy Application Limitations**
   - Some hardware dependencies cannot be met
   - Timing-sensitive applications may face issues
   - Legacy network protocols may not work
   - Direct hardware access not possible
   - USB/serial device passthrough not supported

3. **Hybrid Scenarios**
   - Latency between on-premises and cloud
   - Bandwidth costs for data transfer
   - Complexity in managing hybrid environment
   - VPN/ExpressRoute setup and costs
   - Split DNS and identity management challenges

COST LIMITATIONS
----------------
1. **Pricing Constraints**
   - Pay-per-use can be expensive for 24/7 workloads
   - Data egress charges apply
   - Premium storage costs more
   - Public IP addresses have costs
   - Load balancers and other services add to costs

2. **Commitment Requirements**
   - Reserved instances require 1 or 3-year commitment
   - Cannot change reserved instance size easily
   - Refund limitations on reserved instances
   - Spot VMs can be evicted anytime
   - Azure Hybrid Benefit requires eligible licenses

FEATURE LIMITATIONS
-------------------
1. **VM Extensions**
   - Limited number of extensions per VM (typically ~10)
   - Some extensions conflict with others
   - Extension execution time limits
   - Not all extensions available for all OS versions

2. **Snapshot Limitations**
   - Incremental snapshots have dependencies
   - Snapshot restore creates new disk
   - Cross-region snapshot copy takes time
   - Snapshot deletion requires understanding dependencies

3. **Image Management**
   - Custom images limited to same region (unless replicated)
   - Image versioning requires manual management
   - Shared Image Gallery has quotas
   - Image replication costs apply

GEOGRAPHIC AND REGULATORY
--------------------------
1. **Region Availability**
   - Azure services not available in all regions
   - Some regions have limited VM size offerings
   - New regions take time to get all features
   - Government/sovereign clouds have separate infrastructure

2. **Compliance Limitations**
   - Compliance certifications vary by region
   - Some industries have strict data residency rules
   - Audit log retention limits
   - Not all compliance frameworks covered
   - Customer responsible for application-level compliance

3. **Data Sovereignty**
   - Data may traverse Microsoft backbone across borders
   - Backup data stored in paired region
   - Metadata may be stored outside chosen region
   - Limited control over data routing

SUPPORT LIMITATIONS
-------------------
1. **Technical Support**
   - Support level depends on subscription type
   - Response time varies by severity and plan
   - Some issues require Microsoft investigation
   - Limited support for custom configurations
   - Community support for unsupported scenarios

2. **Service Availability**
   - Preview features not covered by SLA
   - Deprecated features may be removed with notice
   - API version changes require code updates
   - Breaking changes possible in preview features

WORKAROUNDS AND ALTERNATIVES
-----------------------------
- Use VM Scale Sets for higher scale requirements
- Implement application-level solutions for hardware limitations
- Use Azure services (PaaS) where appropriate instead of VMs
- Leverage multiple regions for better availability
- Combine with other Azure services to overcome single-service limits
- Request quota increases for resource limits
- Use Reserved Instances or Savings Plans for cost optimization
- Implement proper architecture patterns for high availability